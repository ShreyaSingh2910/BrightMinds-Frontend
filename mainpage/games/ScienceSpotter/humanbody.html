<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anatomy Scanner â€“ Science Spotter</title>

    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
    <link rel="stylesheet" href="humanbody.css">
</head>

<body>

<h2 class="game-title">ðŸ§¬ Anatomy Scanner</h2>
<p class="game-instruction">
    Drag and drop the organs to their correct positions in the human body.
</p>



<div class="diagram-area">
    <div class="image-container">
        <img src="assets/body.jpeg" class="body-img" />

        <div class="label-wrapper" id="pos-1">
            <div class="drop-zone" data-target="brain">?</div>
        </div>

        <div class="label-wrapper" id="pos-2">
            <div class="drop-zone" data-target="lungs">?</div>
        </div>

        <div class="label-wrapper" id="pos-3">
            <div class="drop-zone" data-target="heart">?</div>
        </div>

        <div class="label-wrapper" id="pos-4">
            <div class="drop-zone" data-target="liver">?</div>
        </div>

        <div class="label-wrapper" id="pos-5">
            <div class="drop-zone" data-target="stomach">?</div>
        </div>

        <div class="label-wrapper" id="pos-6">
            <div class="drop-zone" data-target="kidneys">?</div>
        </div>

        <div class="label-wrapper" id="pos-7">
            <div class="drop-zone" data-target="large-intestine">?</div>
        </div>

        <div class="label-wrapper" id="pos-8">
            <div class="drop-zone" data-target="small-intestine">?</div>
        </div>

    </div>
</div>


<div class="parts-bin">
    <div class="draggable" draggable="true" id="brain">Brain</div>
    <div class="draggable" draggable="true" id="lungs">Lungs</div>
    <div class="draggable" draggable="true" id="heart">Heart</div>
    <div class="draggable" draggable="true" id="liver">Liver</div>
    <div class="draggable" draggable="true" id="stomach">Stomach</div>
    <div class="draggable" draggable="true" id="kidneys">Kidneys</div>
    <div class="draggable" draggable="true" id="large-intestine">Large Intestine</div>
    <div class="draggable" draggable="true" id="small-intestine">Small Intestine</div>
</div>

<button id="check-btn" class="check-btn">Check</button>

<div id="lottie-left" class="corner-lottie left-lottie"></div>
<div id="lottie-right" class="corner-lottie right-lottie"></div>

<div id="congrats-modal" class="modal hidden">
    <div class="modal-card">
        <div id="lottie-success" class="success-lottie"></div>
        <h2>ðŸŽ‰ Amazing!</h2>
        <p>You placed all organs correctly!</p>
        <p id="final-score" style="font-weight:bold; font-size:18px;"></p>
        <div class="modal-buttons">
            <button onclick="restartGame()">Replay</button>
            <button onclick="goBack()">Back</button>
        </div>
    </div>
</div>

<script>



function saveGameScore(gameName, score) {
  const email = localStorage.getItem("userEmail");
  if (!email) return;

  fetch("http://localhost:8080/api/game/saveScore", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: email,
      gameName: gameName,
      score: score
    })
  }).catch(err => console.error("Score save failed", err));
}

function shuffleOptions() {
  const partsBin = document.querySelector('.parts-bin');
  const items = Array.from(partsBin.children);

  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [items[i], items[j]] = [items[j], items[i]];
  }

  items.forEach(item => partsBin.appendChild(item));
}


let attemptCount = 0;

const draggables = document.querySelectorAll('.draggable');
const dropZones  = document.querySelectorAll('.drop-zone');
const checkBtn   = document.getElementById('check-btn');
const totalZones = dropZones.length;
shuffleOptions();

draggables.forEach(item => {
  item.addEventListener('dragstart', () => item.classList.add('dragging'));
  item.addEventListener('dragend', () => item.classList.remove('dragging'));
});

dropZones.forEach(zone => {
  zone.addEventListener('dragover', e => e.preventDefault());

  zone.addEventListener('drop', e => {
    e.preventDefault();
    const dragged = document.querySelector('.dragging');
    if (!dragged) return;
    if (zone.classList.contains('filled')) return;

    zone.innerText = dragged.innerText;
    zone.dataset.placed = dragged.id;
    dragged.style.display = 'none';
  });
});

checkBtn.addEventListener('click', () => {

  attemptCount++;

  let hasWrong = false;
  let correctCount = 0;

  dropZones.forEach(zone => {
    const placed = zone.dataset.placed;
    const correct = zone.dataset.target;
    if (!placed) return;
    if (placed !== correct) hasWrong = true;
  });

  dropZones.forEach(zone => {
    const placed = zone.dataset.placed;
    const correct = zone.dataset.target;
    if (!placed) return;

    if (placed === correct) {
      zone.classList.add('filled');
      zone.classList.remove('wrong');
      correctCount++;
    } else {
      zone.classList.add('wrong');
    }
  });

  if (hasWrong) {
    setTimeout(resetWrongAnswers, 1500);
  } else if (correctCount === totalZones) {
    setTimeout(showCongrats, 800);
  }
});

function resetWrongAnswers() {
  dropZones.forEach(zone => {
    if (zone.classList.contains('wrong')) {
      const option = document.getElementById(zone.dataset.placed);
      if (option) option.style.display = 'inline-block';
      zone.innerText = '?';
      zone.classList.remove('wrong');
      delete zone.dataset.placed;
    }
  });
}

function showCongrats() {

  let finalScore;

  if (attemptCount === 1) finalScore = 10;
  else if (attemptCount === 2) finalScore = 9;
  else if (attemptCount === 3) finalScore = 8;
  else if (attemptCount === 4) finalScore = 7;
  else finalScore = 6;

  saveGameScore("ScienceSpotter-HumanBody", finalScore);

  document.getElementById("final-score").innerText =
    "Score: " + finalScore + "/10";

  document.getElementById('congrats-modal').classList.remove('hidden');
}

function restartGame() {
  location.reload();
}

function goBack() {
  window.location.href = "topic.html";
}

</script>
</body>
</html>
