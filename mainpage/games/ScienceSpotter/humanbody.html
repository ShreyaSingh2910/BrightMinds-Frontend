<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anatomy Scanner â€“ Science Spotter</title>

    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
    <link rel="stylesheet" href="humanbody.css">
</head>

<body>

<h2 class="game-title">ðŸ§¬ Anatomy Scanner</h2>
<p class="game-instruction">
    Drag and drop the organs to their correct positions in the human body.
</p>

<div class="diagram-area">
    <div class="image-container">
        <img src="assets/body.jpeg" class="body-img" />

        <div class="label-wrapper" id="pos-1"><div class="drop-zone" data-target="brain">?</div></div>
        <div class="label-wrapper" id="pos-2"><div class="drop-zone" data-target="lungs">?</div></div>
        <div class="label-wrapper" id="pos-3"><div class="drop-zone" data-target="heart">?</div></div>
        <div class="label-wrapper" id="pos-4"><div class="drop-zone" data-target="liver">?</div></div>
        <div class="label-wrapper" id="pos-5"><div class="drop-zone" data-target="stomach">?</div></div>
        <div class="label-wrapper" id="pos-6"><div class="drop-zone" data-target="kidneys">?</div></div>
        <div class="label-wrapper" id="pos-7"><div class="drop-zone" data-target="large-intestine">?</div></div>
        <div class="label-wrapper" id="pos-8"><div class="drop-zone" data-target="small-intestine">?</div></div>
    </div>
</div>

<div class="parts-bin">
    <div class="draggable" draggable="true" id="brain">Brain</div>
    <div class="draggable" draggable="true" id="lungs">Lungs</div>
    <div class="draggable" draggable="true" id="heart">Heart</div>
    <div class="draggable" draggable="true" id="liver">Liver</div>
    <div class="draggable" draggable="true" id="stomach">Stomach</div>
    <div class="draggable" draggable="true" id="kidneys">Kidneys</div>
    <div class="draggable" draggable="true" id="large-intestine">Large Intestine</div>
    <div class="draggable" draggable="true" id="small-intestine">Small Intestine</div>
</div>

<button id="check-btn" class="check-btn">Check</button>

<div id="lottie-left" class="corner-lottie left-lottie"></div>
<div id="lottie-right" class="corner-lottie right-lottie"></div>


<div id="congrats-modal" class="modal hidden">
    <div class="modal-card">
        <div id="lottie-success" class="success-lottie"></div>
        <h2>ðŸŽ‰ Amazing!</h2>
        <p>You placed all organs correctly!</p>
        <div class="modal-buttons">
            <button onclick="restartGame()">Replay</button>
            <button onclick="goBack()">Back</button>
        </div>
    </div>
</div>


<script>



    function saveGameScore(gameName, score) {
      const email = localStorage.getItem("userEmail");
      if (!email) return;

      fetch("http://localhost:8080/api/game/saveScore", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: email,
          gameName: gameName,
          score: score
        })
      }).catch(err => console.error("Score save failed", err));
    }

        lottie.loadAnimation({
          container: document.getElementById('lottie-left'),
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: 'lottie/student.json'
        });

        lottie.loadAnimation({
          container: document.getElementById('lottie-right'),
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: 'lottie/Funnybrain.json'
        });

        const successAnim = lottie.loadAnimation({
          container: document.getElementById('lottie-success'),
          renderer: 'svg',
          loop: false,
          autoplay: false,
          path: 'lottie/anim1.json'
        });

        const bgSound = new Audio('assets/sounds/background.mp3');
        const correctSound = new Audio('assets/sounds/correctans.mp3');
        const wrongSound = new Audio('assets/sounds/wrongans.mp3');

        bgSound.loop = true;
        bgSound.volume = 0.3;
        correctSound.volume = 1;
        wrongSound.volume = 1;

        document.addEventListener('pointerdown', () => {
          if (bgSound.paused) bgSound.play().catch(()=>{});
        }, { once: true });

        const draggables = document.querySelectorAll('.draggable');
        const dropZones  = document.querySelectorAll('.drop-zone');
        const checkBtn   = document.getElementById('check-btn');
        const totalZones = dropZones.length;

        draggables.forEach(item => {
          item.addEventListener('dragstart', () => item.classList.add('dragging'));
          item.addEventListener('dragend', () => item.classList.remove('dragging'));
        });

        dropZones.forEach(zone => {
          zone.addEventListener('dragover', e => e.preventDefault());

          zone.addEventListener('drop', e => {
            e.preventDefault();
            const dragged = document.querySelector('.dragging');
            if (!dragged) return;

            if (zone.classList.contains('filled')) return;

            if (zone.dataset.placed) {
              const old = document.getElementById(zone.dataset.placed);
              if (old) old.style.display = 'inline-block';
            }

            zone.innerText = dragged.innerText;
            zone.dataset.placed = dragged.id;
            dragged.style.display = 'none';
          });
        });

        checkBtn.addEventListener('click', () => {

          let hasWrong = false;
          let correctCount = 0;

          dropZones.forEach(zone => {
            const placed = zone.dataset.placed;
            const correct = zone.dataset.target;

            if (!placed) return;

            if (placed !== correct) {
              hasWrong = true;
            }
          });

          dropZones.forEach(zone => {
            const placed = zone.dataset.placed;
            const correct = zone.dataset.target;

            if (!placed) return;

            if (placed === correct) {
              zone.classList.add('filled');
              zone.classList.remove('wrong');
              correctCount++;
            } else {
              zone.classList.add('wrong');
            }
          });

          if (hasWrong) {
            wrongSound.currentTime = 0;
            wrongSound.play();

            setTimeout(resetWrongAnswers, 1500);

          } else if (correctCount === totalZones) {
            correctSound.currentTime = 0;
            correctSound.play();

            setTimeout(() => {
              showCongrats();
              bgSound.pause();
            }, 800);
          }
        });

        function resetWrongAnswers() {
          dropZones.forEach(zone => {
            if (zone.classList.contains('wrong')) {
              const option = document.getElementById(zone.dataset.placed);
              if (option) option.style.display = 'inline-block';

              zone.innerText = '?';
              zone.classList.remove('wrong');
              delete zone.dataset.placed;
            }
          });
        }

        function showCongrats() {
          saveGameScore("ScienceSpotter-HumanBody", 10);
          document.getElementById('congrats-modal').classList.remove('hidden');
          successAnim.play();
        }
        function restartGame() {
          bgSound.pause();
          bgSound.currentTime = 0;
          location.reload();
        }

        function goBack() {
          bgSound.pause();
          window.location.href = "topic.html";
        }
</script>
</body>
</html>
