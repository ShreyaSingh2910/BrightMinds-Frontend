<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fun Learning Games</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="home.css">
</head>
<body>
<a href="Dashboard/profile.html" class="profile-wrapper">
  <img
          id="profileAvatar"
          src="Dashboard/assets/avatars/fox.jpeg"
          alt="Profile"
  />
  <span class="profile-text">Profile</span>
</a>

<div class="bubble b1"></div>
<div class="bubble b2"></div>
<div class="bubble b3"></div>

<header class="header">
  <h1>Fun Learning Games</h1>
  <p>Learn by Playing â€¢ Made for Kids</p>
</header>
<div class="main-content">
  <div class="content-wrapper">

    <aside class="rank-board">
      <h3>ğŸ† World Tournament</h3>

      <ul class="rank-list" id="leaderboardList">
      </ul>

      <div class="rank-footer">â­ Gain Excellent Reputation!</div>
    </aside>

    <section class="games carousel-container">

      <button class="carousel-btn left" onclick="moveSlide(-1)">â®</button>

      <div class="carousel-track">

        <a href="games/MemoryGame/index.html" class="carousel-item memory active">
          <span class="card-label memory">â­ Memory</span>
          <div class="icon">ğŸ§ </div>
          <h2>Memory Magic</h2>
          <p>Train your brain with fun memory games</p>
          <button>Play</button>
        </a>

        <a href="games/WordBuilder/index.html" class="carousel-item quiz">
          <span class="card-label english">ğŸ”¤ English</span>
          <div class="icon">ğŸ“˜</div>
          <h2>Word Wizard</h2>
          <p>Build words and improve language</p>
          <button>Play</button>
        </a>

        <a href="games/MatchGame/matchGame.html" class="carousel-item fraction">
          <span class="card-label ss">ğŸ†• SS</span>
          <div class="icon">ğŸ™ï¸</div>
          <h2>Discover & Match</h2>
          <p>Learn states and their cities</p>
          <button>Play</button>
        </a>

        <a href="games/ScienceSpotter/index.html" class="carousel-item memory">
          <span class="card-label science">ğŸ§ª Science</span>
          <div class="icon">ğŸ§¬</div>
          <h2>Science Spotter</h2>
          <p>Discover science concepts</p>
          <button>Play</button>
        </a>

        <a href="games/FractionBuilder/index.html" class="carousel-item fraction">
          <span class="card-label math">â— Math</span>
          <div class="icon">ğŸ•</div>
          <h2>Fraction Builder</h2>
          <p>Master fractions visually</p>
          <button>Play</button>
        </a>

      </div>

      <button class="carousel-btn right" onclick="moveSlide(1)">â¯</button>

    </section>

  </div>
</div>


</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase-init.js"></script>
<script>
  const BASE_URL = "https://brightminds-backend-3.onrender.com";
  function getAvatarImage(avatarName) {
  if (!avatarName) return "Dashboard/assets/avatars/fox.jpeg";
  return `Dashboard/assets/avatars/${avatarName}.jpeg`;
}

async function loadProfileAvatar() {
  const email = localStorage.getItem("userEmail");
  if (!email) return;

  try {
    const res = await fetch(
      `${BASE_URL}/api/game/avatar?email=${email}`
    );


    if (!res.ok) return;

    const avatarName = (await res.text()).trim();
    console.log(avatarName);
    const avatarImg = document.getElementById("profileAvatar");
    avatarImg.src = getAvatarImage(avatarName);

    avatarImg.onerror = function () {
  this.src = "Dashboard/assets/avatars/fox.jpeg";
};

  } catch (err) {
    console.error("Avatar load failed", err);
  }
}

  const items = document.querySelectorAll('.carousel-item');
  const track = document.querySelector('.carousel-track');

  let currentIndex = 0;
  const itemWidth = 300; // card + gap

  function updateCarousel() {
    items.forEach((item, index) => {
      item.classList.toggle('active', index === currentIndex);
    });

    const centerOffset =
      (track.offsetWidth / 2) - (itemWidth / 2);

    const moveX =
      centerOffset - (currentIndex * itemWidth);

    track.style.transform = `translateX(${moveX}px)`;
  }

  function moveSlide(direction) {
    currentIndex += direction;

    if (currentIndex < 0) currentIndex = items.length - 1;
    if (currentIndex >= items.length) currentIndex = 0;

    updateCarousel();
  }
  window.addEventListener("DOMContentLoaded", () => {
  loadProfileAvatar();
  loadLeaderboard();
});

  window.addEventListener("load", updateCarousel);
  window.addEventListener("resize", updateCarousel);


async function loadLeaderboard() {

  const email = localStorage.getItem("userEmail");
  if (!email) return;
  
  const profileRes = await fetch(
    `${BASE_URL}/api/game/profileData?email=${email}&gameName=all`
  );
  const profile = await profileRes.json();
  const loggedUserName = profile.name;
  try {
    const res = await fetch(`${BASE_URL}/api/game/leaderboard`);
    if (!res.ok) return;

    const data = await res.json(); 
    const list = document.getElementById("leaderboardList");

    list.innerHTML = "";

    data.slice(0, 10).forEach(entry => {
      const li = document.createElement("li");

 if (entry.email === email) {
    li.classList.add("current-user");
  }
      li.innerHTML = `
        <span>${entry.rank}</span>
        ${entry.name}
        <em>${entry.score.toLocaleString()}</em>
      `;

      list.appendChild(li);
    });

  } catch (err) {
    console.error("Leaderboard load failed", err);
  }
}

window.addEventListener("DOMContentLoaded", loadLeaderboard);

</script>

<footer class="footer">
  <br>
  <br>
  <br>
  ğŸŒˆ Designed with â¤ï¸ for Young Learners
</footer>

</body>
</html>
